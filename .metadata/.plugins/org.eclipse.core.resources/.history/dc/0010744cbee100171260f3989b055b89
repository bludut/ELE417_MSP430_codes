#include <msp430.h>

void I2C_Init(uint8_t slaveAddr);
uint8_t I2C_Read(uint8_t registerAddr);
int main(void)
{
	WDTCTL = WDTPW | WDTHOLD;	// stop watchdog timer
	
	return 0;
}

void I2C_Init(uint8_t slaveAddr)
{
    //P1.7 -> SDA
    //P1.6 -> SCL
    P1SEL  |= (BIT6 | BIT7);
    P1SEL2 |= (BIT6 | BIT7);
    UCB0CTL1 |= (UCSWRST);      //Reset to USCI module
    //-- USCI Module Set as I2C
    //-- Single Master
    //-- 7Bit Slave Address
    //-- Master Mode
    //-- Sycnhrous Mode
    //-- SMCLCK
    UCB0CTL0 = 0;
    UCB0CTL0 = (UCMST | UCSYNC | UCMODE_3);
    UCB0CTL1 |= (UCSSEL_2);
    UCB0BR0 = 18;                           //Baudrate
    UCB0BR1 = 0;
    UCB0I2CSA = slaveAddr;
    UCB0CTL1 &= ~UCSWRST;
}


uint8_t I2C_Read(uint8_t registerAddr)
{
    I2C_Transmitter();
    if(I2C_GenerateStart()  != I2C_NO_ERROR) return 1;


    UCB0TXBUF = registerAddr;
    while(!(IFG2 & UCB0TXIFG));     //Wait for TXIFG == 1
    IFG2 &= ~(UCB0TXIFG);           //then clear TXIFG

    I2C_Receiver();
    if(I2C_GenerateStart() != I2C_NO_ERROR) return 2;
    if(I2C_GenerateStop()  != I2C_NO_ERROR) return 3;

    while(!(IFG2 & UCB0RXIFG));
    IFG2 &= ~(UCB0RXIFG);
    return UCB0RXBUF;
}
